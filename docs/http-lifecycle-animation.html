<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP İstek Yaşam Döngüsü Animasyonu</title>
    <style>
        :root {
            --primary: #00ADD8;
            --secondary: #4169E1;
            --dark: #1a1a2e;
            --darker: #16213e;
            --light: #e8f4f8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            min-height: 100vh;
            color: var(--light);
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        /* Stage Indicator */
        .stage-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stage-dot {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            opacity: 0.4;
            transition: all 0.3s ease;
        }

        .stage-dot.active {
            opacity: 1;
        }

        .stage-dot.completed {
            opacity: 0.8;
        }

        .stage-dot .dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .stage-dot.active .dot {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--primary);
        }

        .stage-dot.completed .dot {
            background: var(--success);
            border-color: var(--success);
        }

        .stage-dot span {
            font-size: 0.75rem;
            text-align: center;
            max-width: 80px;
        }

        /* Main Animation Area */
        .animation-area {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            min-height: 500px;
            margin-bottom: 30px;
        }

        .side-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .side-panel h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .side-panel h3::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary);
            border-radius: 2px;
        }

        /* Center Visualization */
        .center-viz {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .viz-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .viz-content {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* Packet Visualization */
        .packet {
            background: linear-gradient(135deg, rgba(0, 173, 216, 0.2), rgba(65, 105, 225, 0.2));
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .packet.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .packet-header {
            color: var(--warning);
            border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .packet-body {
            color: var(--success);
        }

        .packet .highlight {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* Animation Elements */
        .data-flow {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .data-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary);
            animation: particleMove 2s ease-in-out infinite;
        }

        @keyframes particleMove {

            0%,
            100% {
                transform: translateX(-100px);
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                transform: translateX(100px);
                opacity: 0;
            }
        }

        /* Code Block */
        .code-block {
            background: #0d1117;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.8rem;
            overflow-x: auto;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-block .keyword {
            color: #ff7b72;
        }

        .code-block .string {
            color: #a5d6ff;
        }

        .code-block .function {
            color: #d2a8ff;
        }

        .code-block .comment {
            color: #8b949e;
        }

        .code-block .number {
            color: #79c0ff;
        }

        /* Explanation Box */
        .explanation {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--success);
            padding: 15px 20px;
            border-radius: 0 10px 10px 0;
            margin-top: auto;
        }

        .explanation h4 {
            color: var(--success);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .explanation p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 173, 216, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Router Diagram */
        .router-diagram {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 400px;
        }

        .route-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .route-item.matched {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--success);
        }

        .route-method {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-right: 10px;
        }

        .route-method.get {
            background: var(--success);
        }

        .route-method.post {
            background: var(--warning);
        }

        .route-method.delete {
            background: var(--danger);
        }

        .route-path {
            font-family: 'Consolas', monospace;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Middleware Pipeline */
        .middleware-pipeline {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mw-item {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .mw-item.active {
            opacity: 1;
            background: rgba(0, 173, 216, 0.2);
            border-color: var(--primary);
        }

        .mw-arrow {
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.2rem;
        }

        /* JSON Response */
        .json-response {
            background: #0d1117;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            width: 100%;
            max-width: 500px;
            border: 2px solid var(--success);
        }

        .json-key {
            color: #79c0ff;
        }

        .json-string {
            color: #a5d6ff;
        }

        .json-number {
            color: #ffa657;
        }

        .json-bool {
            color: #ff7b72;
        }

        /* Typing animation */
        .typing-cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: var(--primary);
            animation: blink 1s infinite;
            margin-left: 2px;
        }

        @keyframes blink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0;
            }
        }

        /* Server Box */
        .server-box {
            background: linear-gradient(135deg, rgba(65, 105, 225, 0.1), rgba(0, 173, 216, 0.1));
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 25px;
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        .server-box h4 {
            color: var(--secondary);
            margin-bottom: 15px;
        }

        /* DB Query */
        .db-query {
            background: #1e1e3f;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            border: 2px solid #7c3aed;
            width: 100%;
            max-width: 500px;
        }

        .sql-keyword {
            color: #ff79c6;
        }

        .sql-table {
            color: #50fa7b;
        }

        .sql-column {
            color: #f1fa8c;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .animation-area {
                grid-template-columns: 1fr;
            }

            .side-panel {
                display: none;
            }
        }

        @media (max-width: 600px) {
            header h1 {
                font-size: 1.8rem;
            }

            .stage-indicator {
                justify-content: center;
            }

            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>HTTP İstek Yaşam Döngüsü - Teknik Derinlemesine İnceleme</h1>
            <p>Bir API isteğinin kapsamlı yolculuğu: İstemci tarayıcısından PostgreSQL'e ve geri dönüşü</p>
        </header>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="stage-indicator" id="stageIndicator">
            <div class="stage-dot" data-stage="0">
                <div class="dot"></div>
                <span>İstemci Talebi</span>
            </div>
            <div class="stage-dot" data-stage="1">
                <div class="dot"></div>
                <span>Paket Yapısı</span>
            </div>
            <div class="stage-dot" data-stage="2">
                <div class="dot"></div>
                <span>TLS Şifreleme</span>
            </div>
            <div class="stage-dot" data-stage="3">
                <div class="dot"></div>
                <span>Sunucu Alımı</span>
            </div>
            <div class="stage-dot" data-stage="4">
                <div class="dot"></div>
                <span>Router Eşleşme</span>
            </div>
            <div class="stage-dot" data-stage="5">
                <div class="dot"></div>
                <span>Middleware</span>
            </div>
            <div class="stage-dot" data-stage="6">
                <div class="dot"></div>
                <span>Handler</span>
            </div>
            <div class="stage-dot" data-stage="7">
                <div class="dot"></div>
                <span>Database</span>
            </div>
            <div class="stage-dot" data-stage="8">
                <div class="dot"></div>
                <span>JSON Serialize</span>
            </div>
            <div class="stage-dot" data-stage="9">
                <div class="dot"></div>
                <span>Yanıt Dönüşü</span>
            </div>
        </div>

        <div class="animation-area">
            <div class="side-panel" id="leftPanel">
                <h3>Teknik Detaylar</h3>
                <div id="technicalDetails">
                    <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">
                        Animasyonu başlatmak için "Animasyonu Başlat" butonuna tıklayın.
                    </p>
                </div>
            </div>

            <div class="center-viz" id="centerViz">
                <h2 class="viz-title" id="vizTitle">HTTP İstek Simülasyonu</h2>
                <div class="viz-content" id="vizContent">
                    <div style="text-align: center; color: rgba(255,255,255,0.6);">
                        <p style="font-size: 2rem; margin-bottom: 20px; font-weight: bold; color: var(--primary);">
                            [START]</p>
                        <p>Animasyonu başlatmak için aşağıdaki butonu kullanın.</p>
                        <p style="margin-top: 10px; font-size: 0.9rem;">
                            Bu animasyon, bir <strong>GET /api/v1/devices</strong> isteğinin<br>
                            Tüm yaşam döngüsünü adım adım gösterecektir.<br><br>
                            <strong>REST Best Practices:</strong><br>
                            • <strong>JSON:</strong> Hafif ve okunabilir veri formatı.<br>
                            • <strong>Versioning:</strong> /api/v1/ gibi path prefix kullanımı.<br>
                            • <strong>Stateless:</strong> Her istek gerekli tüm bilgiyi taşır.<br>
                            • <strong>API-First:</strong> Koddan önce API tasarımının (kontratın) yapılması.<br>
                            • <strong>Nouns:</strong> Endpointler eylem değil, kaynak isimleridir.<br>
                            • <strong>Docs:</strong> Swagger/OpenAPI ile dokümantasyon (Best Practice).<br>
                            • <strong>Comp:</strong> Geriye dönük uyumluluğu korumak (Breaking Changes'den kaçınmak).
                        </p>
                        <div
                            style="margin-top: 20px; font-size: 0.8rem; border: 1px dashed var(--primary); padding: 10px; border-radius: 8px;">
                            <strong>REST Mimari Kısıtlamaları:</strong><br>
                            Stateless • Client-Server • Cacheable • Layered System • Uniform Interface
                        </div>
                    </div>
                </div>
            </div>

            <div class="side-panel" id="rightPanel">
                <h3>Aktif Bileşen</h3>
                <div id="activeComponent">
                    <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">
                        Henüz bir bileşen aktif değil.
                    </p>
                </div>
            </div>
        </div>

        <!-- Request Type Selector -->
        <div class="method-selector"
            style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <button class="method-btn active" data-method="GET"
                style="padding: 10px 20px; border: 2px solid #10b981; background: rgba(16,185,129,0.2); color: #10b981; border-radius: 8px; cursor: pointer; font-weight: bold;">GET
                - Read</button>
            <button class="method-btn" data-method="POST"
                style="padding: 10px 20px; border: 2px solid #f59e0b; background: transparent; color: #f59e0b; border-radius: 8px; cursor: pointer; font-weight: bold;">POST
                - Create</button>
            <button class="method-btn" data-method="PUT"
                style="padding: 10px 20px; border: 2px solid #3b82f6; background: transparent; color: #3b82f6; border-radius: 8px; cursor: pointer; font-weight: bold;">PUT
                - Replace</button>
            <button class="method-btn" data-method="PATCH"
                style="padding: 10px 20px; border: 2px solid #8b5cf6; background: transparent; color: #8b5cf6; border-radius: 8px; cursor: pointer; font-weight: bold;">PATCH
                - Update</button>
            <button class="method-btn" data-method="DELETE"
                style="padding: 10px 20px; border: 2px solid #ef4444; background: transparent; color: #ef4444; border-radius: 8px; cursor: pointer; font-weight: bold;">DELETE
                - Remove</button>
        </div>

        <div class="controls">
            <button class="btn btn-secondary" id="prevBtn" disabled>
                Önceki
            </button>
            <button class="btn btn-primary" id="nextBtn">
                Animasyonu Baslat
            </button>
            <button class="btn btn-secondary" id="resetBtn">
                Sıfırla
            </button>
        </div>
    </div>

    <script>
        // Animation stages data
        const stages = [
            {
                title: "1. İstemci HTTP Talebi Oluşturuyor ",
                technical: `<strong> RFC 7231 §4.3.1</strong><br>
                    HTTP Method: GET<br><br>
                    <strong> Safe & Idempotent: EVET!</strong><br>
                    Sunucu state'i değişmez<br>
                    N kez çağır, aynı sonuç<br><br>
                    - Pagination: Cursor-based (Performans için) vs Index-based (Sayfa numarası için).<br>
                    - Filter: Query params (URL içinde veri taşıma).<br><br>
                    <strong>Günlük Hayat:</strong> Restoranda garsona "Bana menüden sadece içecekleri getir" demek gibidir.`,
                component: `<strong>Client Application</strong><br><br>
                    <em>Gerçek Senaryo:</em><br>
                    Nokia router'ları sorgulamak<br>
                    için GET isteği gönderiliyor<br><br>
                    <strong>Best Practices:</strong><br>
                    - Nouns, no verbs: /devices (OK) /getDevices (BAD)<br>
                    - Versioning: /api/v1/devices<br>
                    - Resource Nesting: /api/v1/devices/{id}`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--primary);"> [GET] ---> [SERVER:3000/api/v1/devices]</div>
                        <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">
                             Fun Fact: GET, HTTP'nin en eski ve en çok kullanılan method'udur!
                        </p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// GET İsteği - Body YOK!</span><br>
                        <span class="comment">// Query parametreleri ile filtreleme</span><br><br>
                        <span class="keyword">fetch</span>(<span class="string">"https://localhost:3000/api/v1/devices?vendor=Nokia"</span>, {<br>
                        &nbsp;&nbsp;<span class="keyword">method</span>: <span class="string">"GET"</span>,<br>
                        &nbsp;&nbsp;<span class="keyword">headers</span>: {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"Accept"</span>: <span class="string">"application/json"</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"Authorization"</span>: <span class="string">"Bearer {{token}}"</span><br>
                        &nbsp;&nbsp;}<br>
                        });
                    </div>
                `,
                progress: 10
            },
            {
                title: "2. OSI Katmanları & Kapsülleme",
                technical: `<strong>Paket Katmanlari:</strong><br><br>
                    [L7] <em>Application Layer</em><br>
                    &nbsp;&nbsp;-> HTTP Headers + Body<br><br>
                    [L4] <em>Transport Layer</em><br>
                    &nbsp;&nbsp;-> TCP Segmentasyon<br><br>
                    [L3] <em>Network Layer</em><br>
                    &nbsp;&nbsp;-> IP Adresleme<br><br>
                    [L2] <em>Data Link</em><br>
                    &nbsp;&nbsp;-> MAC Frame<br><br>
                    <strong>Günlük Hayat:</strong> Bir mektubu önce zarfa koyup, sonra üzerine adres yazıp, en son posta kutusuna atmak gibi her adımda yeni bir katman eklenir.`,
                component: `<strong>TCP/IP Stack</strong><br><br>
                    Veri, OSI katmanlarından geçirilerek "paketleniyor".<br><br>
                    Her katman kendi header'ını ekler (Encapsulation).`,
                content: `
                    <div class="packet visible">
                        <div class="packet-header">
                            <strong>[HTTP REQUEST HEADERS]</strong><br><br>
                            <span class="highlight">GET</span> /api/v1/devices?vendor=Nokia HTTP/1.1<br>
                            Host: localhost:3000<br>
                            Accept: application/json<br>
                            Authorization: Bearer eyJhbGc...<br>
                            User-Agent: PostmanRuntime/7.32<br>
                            Connection: keep-alive
                        </div>
                        <div class="packet-body">
                            <strong>[BODY]:</strong> (GET istegi, body yok)
                        </div>
                    </div>
                `,
                progress: 20
            },
            {
                title: "3. TLS/HTTPS Şifreleme",
                technical: `<strong>Güvenlik Mimarisi:</strong> TLS 1.3<br><br>
                    <strong>1. Asimetrik Aşama (Handshake):</strong><br>
                    <em>ECDHE</em> (Elliptic Curve Diffie-Hellman) ile anahtar değişimi yapılır. Sertifika ile sunucu kimliği doğrulanır.<br><br>
                    <strong>2. Simetrik Aşama (Data Transfer):</strong><br>
                    AES-256-GCM ile veriler şifrelenir. <em>Perfect Forward Secrecy (PFS)</em> sayesinde oturum anahtarı çalınsa bile geçmiş trafik okunamaz.<br><br>
                    <strong>Günlük Hayat:</strong> Aranızda sadece sizin bildiğiniz gizli bir dille konuşmak gibidir; dışarıdan biri duysa da hiçbir şey anlamaz.`,
                component: `<strong>High-Level Cryptography</strong><br><br>
                    <em>Algorithm:</em> AES-256-GCM<br>
                    <em>Auth:</em> HMAC-SHA384<br><br>
                    <span style="color: var(--success);">[SECURE] Session Keys Active</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 15px; color: var(--success);">[TLS ENCRYPTED]</div>
                        <p style="color: var(--success); font-weight: 600;">TLS Handshake Tamamlandı!</p>
                    </div>
                    <div class="server-box" style="border-color: var(--success);">
                        <h4 style="color: var(--success);">Şifreli Kanal Aktif</h4>
                        <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-bottom: 15px;">
                            AES-256-GCM ile şifrelenen veri:
                        </p>
                        <div style="background: #0d1117; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.75rem; word-break: break-all; color: var(--warning);">
                            x7f2a9c4e8b1d3f6a...encrypted_payload...
                            <br>k8m3n7p2q5r9s1t4...hmac_signature...
                        </div>
                    </div>
                `,
                progress: 30
            },
            {
                title: "4. Sunucu İsteği Alıyor ",
                technical: `<strong>Sunucu:</strong> Go net/http<br><br>
                    <strong>Port:</strong> 3000 (TLS)<br><br>
                    <strong>Goroutine:</strong> Her istek için yeni bir goroutine başlatılır.<br><br>
                    1. TCP Accept()<br>
                    2. TLS Decrypt<br>
                    3. HTTP Parse<br><br>
                    <strong>Günlük Hayat:</strong> Bir binanın resepsiyonuna gelen ziyaretçinin kimliğini kontrol edip içeri almak gibidir.`,
                component: `<strong>http.Server{}</strong><br><br>
                    <code style="font-size: 0.8rem; background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 4px; display: block; margin-top: 10px;">
                    ListenAndServeTLS(":3000", cert, key, handler)
                    </code>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--secondary);">[SERVER RECEIVED PACKET]</div>
                        <p style="color: rgba(255,255,255,0.7);">Sunucu paketi aldı ve çözümlüyor...</p>
                    </div>
                    <div class="server-box" style="border-color: var(--secondary); margin-bottom: 20px;">
                        <h4 style="color: var(--secondary);">Go HTTP Server (net/http)</h4>
                        <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">İstek yeni bir goroutine (LWP) altında işlenmeye başlandı.</p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// cmd/api/main.go</span><br><br>
                        <span class="keyword">func</span> <span class="function">main</span>() {<br>
                        &nbsp;&nbsp;server := &http.<span class="function">Server</span>{<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Addr: <span class="string">":3000"</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Handler: router,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;TLSConfig: tlsConfig,<br>
                        &nbsp;&nbsp;}<br><br>
                        &nbsp;&nbsp;<span class="comment">// Yeni goroutine başlatılıyor...</span><br>
                        &nbsp;&nbsp;<span class="keyword">go</span> handleRequest(conn)<br>
                        }
                    </div>
                `,
                progress: 40
            },
            {
                title: "5. Router Path Eşleştirme ",
                technical: `<strong>Router:</strong> Gorilla Mux<br><br>
                    <strong>Algoritma:</strong> Trie-based pattern matching<br><br>
                    <strong>Eşleşen Route:</strong><br>
                    <code>/devices</code> › <code>GetAllDevices</code><br><br>
                    <strong>Path Variables:</strong><br>
                    Query: <code>vendor=Nokia</code><br><br>
                    <strong>Günlük Hayat:</strong> Binaya giren kişinin elindeki fişe bakıp onu doğru odaya (servise) yönlendiren yön tabelasıdır.`,
                component: `<strong>mux.Router{}</strong><br><br>
                    Route Tablosunda eşleşme aranıyor...<br><br>
                    <span style="color: var(--success);">? Eşleşme bulundu!</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p style="color: rgba(255,255,255,0.7);">İstek yolu route Tablosunda aranıyor...</p>
                    </div>
                    <div class="router-diagram">
                        <div class="route-item">
                            <span class="route-method post">POST</span>
                            <span class="route-path">/users/login</span>
                        </div>
                        <div class="route-item matched">
                            <span class="route-method get">GET</span>
                            <span class="route-path">/devices ?</span>
                        </div>
                        <div class="route-item">
                            <span class="route-method get">GET</span>
                            <span class="route-path">/devices/{id}</span>
                        </div>
                        <div class="route-item">
                            <span class="route-method delete">DEL</span>
                            <span class="route-path">/devices/{id}</span>
                        </div>
                        <div class="route-item">
                            <span class="route-method get">GET</span>
                            <span class="route-path">/interfaces</span>
                        </div>
                    </div>
                `,
                progress: 50
            },
            {
                title: "6. Middleware Zinciri ",
                technical: `<strong>Middleware Pipeline:</strong><br><br>
                    1. <em>Logging & Tracing</em><br>
                    &nbsp;&nbsp;› <strong>X-Request-ID</strong> atanır.<br>
                    &nbsp;&nbsp;› İstek başlangıç zamanı (nanoseconds).<br><br>
                    2. <em>Security Headers</em><br>
                    &nbsp;&nbsp;› CORS, XSS-Protection, HSTS.<br>
                    &nbsp;&nbsp;› CSP (Content Security Policy).<br><br>
                    3. <em>Rate Limiting (Leaky Bucket)</em><br>
                    &nbsp;&nbsp;› IP bazlı 60 req/min limit kontrolü.<br>
                    &nbsp;&nbsp;› 429 Too Many Requests risk kontrolü.<br><br>
                    4. <em>Authentication & Context</em><br>
                    &nbsp;&nbsp;› JWT verify & UserID extraction.<br>
                    &nbsp;&nbsp;› <code>context.WithValue()</code> ile handler'a veri aktarımı.<br><br>
                    <strong>Günlük Hayat:</strong> Havalimanında uçağa binmeden önce pasaport kontrolü, bilet kontrolü ve X-ray cihazından geçmek gibidir.`,
                component: `<strong>Middleware Chain (Onion Architecture)</strong><br><br>
                    Her katman isteği sarmalar (Wrap).<br><br>
                    <span style="color: var(--warning);">[CONTEXT] RequestID: {{uuid}}</span><br>
                    <span style="color: var(--success);">[AUTH] Role: Read-Only User</span><br><br>
                    <span style="color: var(--danger); font-size: 0.85rem;">
                        <strong>Mülakat: Authentication vs Authorization?</strong><br>
                        <strong>Authentication:</strong> Who are you? (Identity verify) - 401<br>
                        <strong>Authorization:</strong> What can you do? (RBAC/Permissions) - 403
                    </span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <p style="color: rgba(255,255,255,0.7);">İstek koruma ve loglama katmanlarından geçiyor...</p>
                    </div>
                    <div class="middleware-pipeline">
                        <div class="mw-item active" title="Loglama">[1] Logger & Trace</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active" title="Güvenlik Headers">[2] Security (CORS)</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active" title="Hız Sınırı">[3] RateLimit</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active" title="Kimlik Doğrulama">[4] Auth (JWT)</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item" style="background: rgba(16,185,129,0.3); border-color: var(--success); opacity: 1;">[TARGET] Handler</div>
                    </div>
                    <div class="code-block" style="margin-top: 30px;">
                        <span class="comment">// internal/middleware/chain.go</span><br><br>
                        <span class="keyword">func</span> <span class="function">Chain</span>(h http.Handler) http.Handler {<br>
                        &nbsp;&nbsp;<span class="keyword">return</span> LoggingMiddleware(<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;SecurityMiddleware(<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RateLimitMiddleware(<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthMiddleware(h))))<br>
                        }
                    </div>
                `,
                progress: 60
            },
            {
                title: "7. Handler İş Mantığı ",
                technical: `<strong>Handler:</strong> GetAllDevices<br><br>
                    <strong>Dosya:</strong><br>
                    <code>internal/api/handlers/devices.go</code><br><br>
                    <strong>İşlemler:</strong><br>
                    1. Query parametrelerini parse et<br>
                    2. Repository'yi çağır<br>
                    3. Sonucu JSON'a çevir<br>
                    4. Response yaz<br><br>
                    <strong>Günlük Hayat:</strong> Mutfağa gelen siparişi şefin alıp, malzemeleri toplayıp yemeği hazırlamaya başlamasıdır.`,
                component: `<strong>handlers.GetAllDevices()</strong><br><br>
                    İş mantığı çalışıyor...<br><br>
                    Query: <code>vendor=Nokia</code>`,
                content: `
                    <div class="code-block">
                        <span class="comment">// internal/api/handlers/devices.go</span><br><br>
                        <span class="keyword">func</span> <span class="function">GetAllDevices</span>(w http.ResponseWriter, r *http.Request) {<br><br>
                        &nbsp;&nbsp;<span class="comment">// 1. Query parametrelerini al</span><br>
                        &nbsp;&nbsp;vendor := r.URL.Query().Get(<span class="string">"vendor"</span>)<br><br>
                        &nbsp;&nbsp;<span class="comment">// 2. Repository'yi çağır</span><br>
                        &nbsp;&nbsp;repo := sqlconnect.<span class="function">NewDeviceRepository</span>(db)<br>
                        &nbsp;&nbsp;devices, err := repo.<span class="function">GetAll</span>(filters)<br><br>
                        &nbsp;&nbsp;<span class="comment">// 3. JSON olarak encode et</span><br>
                        &nbsp;&nbsp;json.<span class="function">NewEncoder</span>(w).Encode(devices)<br>
                        }
                    </div>
                `,
                progress: 70
            },
            {
                title: "8. Veritabanı Sorgusu ",
                technical: `<strong>Database:</strong> PostgreSQL 15<br><br>
                    <strong>Driver:</strong> lib/pq<br><br>
                    <strong>Bağlantı:</strong> Connection Pool<br>
                    &nbsp;&nbsp;› Max: 25 bağlantı<br>
                    &nbsp;&nbsp;› Idle: 5 bağlantı<br><br>
                    <strong>Sorgu Tipi:</strong> Prepared Statement<br><br>
                    <strong>Günlük Hayat:</strong> Dev bir kütüphanede, kütüphanecinin gidip raftan doğru kitabı arayıp bulup getirmesi işlemidir.`,
                component: `<strong>DeviceRepository.GetAll()</strong><br><br>
                    SQL Builder ile güvenli sorgu oluşturuluyor.<br><br>
                    <span style="color: var(--success);">? Parameterized Query</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #7c3aed;">[PostgreSQL Query Execution]</div>
                        <p style="color: rgba(255,255,255,0.7);">PostgreSQL'e sorgu gonderiliyor...</p>
                    </div>
                    <div class="db-query">
                        <span class="sql-keyword">SELECT</span> <span class="sql-column">id, hostname, ip, vendor, model, status</span><br>
                        <span class="sql-keyword">FROM</span> <span class="sql-table">devices</span><br>
                        <span class="sql-keyword">WHERE</span> <span class="sql-column">vendor</span> = <span style="color: #bd93f9;">$1</span><br>
                        <span class="sql-keyword">ORDER BY</span> <span class="sql-column">hostname</span> <span class="sql-keyword">ASC</span>;<br><br>
                        <span style="color: #6272a4;">-- Parametre: $1 = 'Nokia'</span><br>
                        <span style="color: #6272a4;">-- Sonuç: 12 satır, 0.8ms</span><br><br>
                        <span style="color: var(--danger); font-size: 0.8rem;">
                            <strong>Mülakat: N+1 Problemi Nedir?</strong><br>
                            N kayıt için her birinin ilişkisini (örn: postları) 
                            ayrı sorguyla çekmek! Çözüm: <em>JOIN</em> veya <em>PREFETCH</em>.
                        </span>
                    </div>
                `,
                progress: 80
            },
            {
                title: "9. JSON Serileştirme ",
                technical: `<strong>Encoder:</strong> encoding/json<br><br>
                    <strong>Struct Tags:</strong><br>
                    <code>json:"hostname"</code><br>
                    <code>json:"id,omitempty"</code><br><br>
                     <strong>Content-Type:</strong><br>
                    <code>application/json; charset=utf-8</code><br><br>
                    <strong>Günlük Hayat:</strong> Hazırlanan yemeğin pakete konulup servis edilmeye hazır hale getirilmesidir.`,
                component: `<strong>json.Marshal()</strong><br><br>
                    Go struct'ları JSON formatına dönüştürülüyor.<br><br>
                    <span style="color: var(--success);">12 cihaz serileştirildi.</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p style="color: rgba(255,255,255,0.7);">Veri JSON formatına dönüştürülüyor...</p>
                    </div>
                    <div class="json-response">
                        [<br>
                        &nbsp;&nbsp;{<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">"a1b2c3d4-..."</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"hostname"</span>: <span class="json-string">"ist-core-rtr-01"</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"ip"</span>: <span class="json-string">"10.10.1.1"</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"vendor"</span>: <span class="json-string">"Nokia"</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"model"</span>: <span class="json-string">"7750 SR-12"</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"status"</span>: <span class="json-string">"active"</span><br>
                        &nbsp;&nbsp;},<br>
                        &nbsp;&nbsp;{<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"_links"</span>: [<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="json-key">"rel"</span>: <span class="json-string">"next"</span>, <span class="json-key">"href"</span>: <span class="json-string">"/devices?offset=20"</span>},<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="json-key">"rel"</span>: <span class="json-string">"self"</span>, <span class="json-key">"href"</span>: <span class="json-string">"/devices"</span>}<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;]<br>
                        &nbsp;&nbsp;}<br>
                        ]
                    </div>
                `,
                progress: 90
            },
            {
                title: "10. Yanıt: 200 OK",
                technical: `<strong>Response Status:</strong> 200 OK<br><br>
                    <strong>Headers:</strong><br>
                    • Content-Type: application/json<br>
                    • X-Response-Time: 12ms<br>
                    • X-Request-ID: abc123<br><br>
                    <strong>Toplam Süre:</strong> ~15ms<br><br>
                    <strong>Boyut:</strong> 2.4 KB`,
                component: `<strong>http.ResponseWriter</strong><br><br>
                    Yanıt TLS ile şifrelenerek istemciye gönderildi.<br><br>
                    <span style="color: var(--success); font-size: 1.2rem;">? Başarılı!</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 2rem; margin-bottom: 15px; color: var(--success);">[SUCCESS: 200 OK]</div>
                        <p style="color: var(--success); font-size: 1.3rem; font-weight: 600;">Request Completed Successfully!</p>
                    </div>
                    <div class="explanation" style="max-width: 500px;">
                        <h4>Full Request Cycle Complete</h4>
                        <p>
                            İstek tamamlandı. Richardson Seviye 3 (HATEOAS) standartlarına uygun bir GET döngüsü gerçekleşti.
                        </p>
                        <br>
                        <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">
                            <strong>Caching:</strong> ETag: "abc123" üretildi (304 Not Modified için hazır).<br>
                            <strong>Negotiation:</strong> Accept: application/json başarılı.
                        </p>
                    </div>
                `,
                progress: 100
            }
        ];

        // GET Stages (existing)
        const getStages = stages;

        // POST Stages - Create new device (10 adım - GET gibi)
        const postStages = [
            {
                title: "1. POST İsteği - Kaynak Oluşturma",
                technical: `<strong>RFC 7231 §4.3.3</strong><br>
                    HTTP Method: POST<br><br>
                    <strong>Properties:</strong><br>
                    - Safe: ? HAYIR<br>
                    - Idempotent: ? HAYIR<br>
                    - Cacheable: ?? Sadece r.headers varsa<br><br>
                    <strong>"Do Something" Ops:</strong><br>
                    CRUD dışı işlemler (reboot vb.)<br>
                    için POST /api/v1/device/{id}/reboot<br>
                    gibi eylem isimli kaynaklar kullanılır.`,
                component: `<strong>POST /devices</strong><br><br>
                    <em>Network Automation:</em><br>
                    Yeni Nokia router'ı envantere<br>
                    ekleme işlemi<br><br>
                    <em>Request Body:</em><br>
                    JSON payload gerekli!<br>
                    Content-Type: application/json<br><br>
                    <em>Mülakat:</em><br>
                    <em>"POST vs PUT farkı?"</em><br>
                    POST: Yeni oluştur (koleksiyon)<br>
                    PUT: Mevcut değiştir (kaynak)`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 15px; color: #f59e0b;">[POST] ---> /api/v1/devices</div>
                        <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">
                            Fun Fact: POST, HTML form ile gelen en eski data submission method'u!
                        </p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// POST - Yeni kaynak oluşturma (Not idempotent)</span><br>
                        <span class="comment">// Payload: Request body içindeki asıl veridir.</span><br>
                        POST /api/v1/devices HTTP/1.1<br>
                        Host: localhost:3000<br>
                        Content-Type: application/json<br>
                        Idempotency-Key: uuid-777-555<br><br>
                        {<br>
                        &nbsp;&nbsp;<span class="string">"hostname"</span>: <span class="string">"ank-edge-rtr-05"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"ip"</span>: <span class="string">"10.20.5.1"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"vendor"</span>: <span class="string">"Nokia"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"model"</span>: <span class="string">"7750 SR-1"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"status"</span>: <span class="string">"provisioning"</span><br>
                        }
                    </div>
                `,
                progress: 10
            },
            {
                title: "2. OSI Katmanları & Kapsülleme",
                technical: `<strong>Paket Katmanları:</strong><br><br>
                    [L7] <em>Application Layer</em><br>
                    &nbsp;&nbsp;-> HTTP Headers + Body<br><br>
                    [L4] <em>Transport Layer</em><br>
                    &nbsp;&nbsp;-> TCP Segmentasyon<br><br>
                    [L3] <em>Network Layer</em><br>
                    &nbsp;&nbsp;-> IP Adresleme<br><br>
                    [L2] <em>Data Link</em><br>
                    &nbsp;&nbsp;-> MAC Frame`,
                component: `<strong>TCP/IP Stack</strong><br><br>
                    Veri, OSI katmanlarından geçirilerek "paketleniyor".<br><br>
                    Her katman kendi header'ını ekler (Encapsulation).<br><br>
                    <em>Content-Length:</em><br>
                    Body boyutu hesaplanıyor<br>
                    ~200 bytes JSON data`,
                content: `
                    <div class="packet visible">
                        <div class="packet-header">
                            <strong>[HTTP REQUEST HEADERS]</strong><br><br>
                            <span class="highlight">POST</span> /devices HTTP/1.1<br>
                            Host: localhost:3000<br>
                            Content-Type: application/json<br>
                            Content-Length: 185<br>
                            Authorization: Bearer eyJhbGc...<br>
                            Connection: keep-alive
                        </div>
                        <div class="packet-body">
                            <strong>[BODY]:</strong> {"hostname":"ank-edge-rtr-05",...}
                        </div>
                    </div>
                `,
                progress: 20
            },
            {
                title: "3. TLS/HTTPS Şifreleme",
                technical: `<strong>POST Payload Protection:</strong><br><br>
                    <strong>AEAD Şifreleme:</strong><br>
                    TLS 1.3'te 'Authenticated Encryption with Associated Data' kullanılır. Sadece gizlilik değil, verinin yolda değişmediği de garanti edilir.<br><br>
                    <strong>Forward Secrecy:</strong><br>
                    Her oturum için farklı anahtar! Eğer sunucu anahtarı (private key) çalınırsa, bu POST isteğinin içeriği hala güvendedir.`,
                component: `<strong>End-to-End Encryption</strong><br><br>
                    <em>Algorithm:</em> AES-256-GCM<br>
                    <em>Exchange:</em> X25519 (ECDHE)<br><br>
                    <span style="color: var(--success);">[ENCRYPTED] JSON Body Secured</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 15px; color: var(--success);">[TLS ENCRYPTED]</div>
                        <p style="color: var(--success); font-weight: 600;">TLS Handshake Tamamlandı!</p>
                    </div>
                    <div class="server-box" style="border-color: var(--success);">
                        <h4 style="color: var(--success);">Şifreli Kanal Aktif</h4>
                        <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-bottom: 15px;">
                            AES-256-GCM ile şifrelenen veri:
                        </p>
                        <div style="background: #0d1117; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.75rem; word-break: break-all; color: var(--warning);">
                            x7f2a9c4e8b1d3f6a...encrypted_payload...
                            <br>k8m3n7p2q5r9s1t4...hmac_signature...
                        </div>
                    </div>
                `,
                progress: 30
            },
            {
                title: "4. Sunucu İsteği Alıyor",
                technical: `<strong>Sunucu:</strong> Go net/http<br><br>
                    <strong>Port:</strong> 3000 (TLS)<br><br>
                    <strong>Goroutine:</strong> Her istek için yeni bir goroutine başlatılır.<br><br>
                    <strong>İşlem:</strong><br>
                    1. TCP Accept()<br>
                    2. TLS Decrypt (Body dahil)<br>
                    3. HTTP Parse<br>
                    4. Body okuma başlatıldı`,
                component: `<strong>http.Server{}</strong><br><br>
                    <code style="font-size: 0.8rem; background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 4px; display: block; margin-top: 10px;">
                    ListenAndServeTLS(":3000", cert, key, handler)
                    </code><br><br>
                    <em>Body Buffering:</em><br>
                    io.ReadCloser hazır`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--secondary);">[SERVER RECEIVED POST]</div>
                        <p style="color: rgba(255,255,255,0.7);">Sunucu paketi aldı ve çözümlüyor...</p>
                    </div>
                    <div class="server-box" style="border-color: var(--secondary); margin-bottom: 20px;">
                        <h4 style="color: var(--secondary);">Go HTTP Server (net/http)</h4>
                        <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">İstek yeni bir goroutine (LWP) altında işlenmeye başlandı.</p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// cmd/api/main.go</span><br><br>
                        <span class="keyword">func</span> <span class="function">main</span>() {<br>
                        &nbsp;&nbsp;server := &http.<span class="function">Server</span>{<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Addr: <span class="string">":3000"</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;Handler: router,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;TLSConfig: tlsConfig,<br>
                        &nbsp;&nbsp;}<br><br>
                        &nbsp;&nbsp;<span class="comment">// POST body okunmaya hazır</span><br>
                        &nbsp;&nbsp;<span class="keyword">go</span> handleRequest(conn)<br>
                        }
                    </div>
                `,
                progress: 40
            },
            {
                title: "5. Router Path Eşleştirme",
                technical: `<strong>Router:</strong> Gorilla Mux<br><br>
                    <strong>Algoritma:</strong> Trie-based pattern matching<br><br>
                    <strong>Eşleşen Route:</strong><br>
                    POST <code>/devices</code> -> <code>CreateDevice</code><br><br>
                    <strong>Method Check:</strong><br>
                    POST == POST (OK)`,
                component: `<strong>mux.Router{}</strong><br><br>
                    Route Tablosunda eşleşme aranıyor...<br><br>
                    <span style="color: var(--success);">? POST /devices eşleşti!</span><br><br>
                    <em>Handler:</em><br>
                    handlers.CreateDevice`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p style="color: rgba(255,255,255,0.7);">İstek yolu route Tablosunda aranıyor...</p>
                    </div>
                    <div class="router-diagram">
                        <div class="route-item">
                            <span class="route-method get">GET</span>
                            <span class="route-path">/api/v1/devices</span>
                        </div>
                        <div class="route-item matched">
                            <span class="route-method post">POST</span>
                            <span class="route-path">/api/v1/devices ?</span>
                        </div>
                        <div class="route-item">
                            <span class="route-method put">PUT</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                        <div class="route-item">
                            <span class="route-method delete">DEL</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                    </div>
                `,
                progress: 50
            },
            {
                title: "6. Middleware Zinciri",
                technical: `<strong>Write Operation Middleware:</strong><br><br>
                    1. <em>Idemp.Key Check</em><br>
                    &nbsp;&nbsp;› Duplicate request protection.<br><br>
                    2. <em>Ownership / RBAC</em><br>
                    &nbsp;&nbsp;› User can write here? (Authorization).<br><br>
                    3. <em>Schema Validation</em><br>
                    &nbsp;&nbsp;› JSON structure check.<br><br>
                    4. <em>Write Limit</em><br>
                    &nbsp;&nbsp;› Strict rate limits for state changes.`,
                component: `<strong>Security & Validation</strong><br><br>
                    <em>POST İşlemi Ek Koruması:</em><br>
                    Payload boyutu ve tipi kontrol ediliyor.<br><br>
                    <span style="color: var(--primary);">[CHECK] Idempotency Token</span><br>
                    <span style="color: var(--success);">[AUTH] Permissions Verified</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <p style="color: rgba(255,255,255,0.7);">Create (POST) güvenliği ve yetki kontrolleri yapılıyor...</p>
                    </div>
                    <div class="middleware-pipeline">
                        <div class="mw-item active">Idemp.Key</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Ownership</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Schema-Chk</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Write-Limit</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item" style="background: rgba(245,158,11,0.3); border-color: var(--warning); opacity: 1;">[TARGET] CreateDevice</div>
                    </div>
                `,
                progress: 60
            },
            {
                title: "7. JSON Body Parse & Validation",
                technical: `<strong>Package:</strong> encoding/json<br><br>
                    <strong>Decode Süreci:</strong><br>
                    1. r.Body (io.ReadCloser) alınır<br>
                    2. json.NewDecoder oluşturulur<br>
                    3. Decode() struct'a yazar<br>
                    4. defer r.Body.Close()<br><br>
                    <strong>Doğrulama:</strong><br>
                    - hostname: zorunlu, max 64 char<br>
                    - ip: regexp format<br>
                    - vendor: zorunlu<br><br>
                    <strong>Hata:</strong> 400 Bad Request`,
                component: `<strong>json.Decoder + Validator</strong><br><br>
                    <em>Struct Eşleştirme:</em><br>
                    - "hostname" -> Device.Hostname<br>
                    - "ip" -> Device.IP<br>
                    - "vendor" -> Device.Vendor<br><br>
                    <em>Validation Result:</em><br>
                    [OK] Tüm alanlar geçerli!`,
                content: `
                    <div class="code-block">
                        <span class="comment">// internal/api/handlers/devices.go</span><br><br>
                        <span class="keyword">func</span> <span class="function">CreateDevice</span>(w http.ResponseWriter, r *http.Request) {<br>
                        &nbsp;&nbsp;<span class="keyword">var</span> device models.Device<br><br>
                        &nbsp;&nbsp;<span class="comment">// JSON body'yi parse et</span><br>
                        &nbsp;&nbsp;decoder := json.<span class="function">NewDecoder</span>(r.Body)<br>
                        &nbsp;&nbsp;err := decoder.<span class="function">Decode</span>(&device)<br>
                        &nbsp;&nbsp;<span class="keyword">if</span> err != nil {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;http.<span class="function">Error</span>(w, <span class="string">"RFC 7807: Validation Error"</span>, 422)<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><br>
                        &nbsp;&nbsp;}<br><br>
                        &nbsp;&nbsp;<span class="comment">// Mülakat: 400 vs 422?</span><br>
                        &nbsp;&nbsp;<span class="comment">// 400: Malformed JSON (syntax hatası)</span><br>
                        &nbsp;&nbsp;<span class="comment">// 422: Valid JSON, invalid data (mantıksal hata)</span><br>
                        }
                    </div>
                `,
                progress: 70
            },
            {
                title: "8. UUID Üretimi",
                technical: `<strong>Package:</strong><br>
                    github.com/google/uuid<br><br>
                    <strong>UUID Versiyonu:</strong><br>
                    Version 4 (Random)<br><br>
                    <strong>Format (RFC 4122):</strong><br>
                    8-4-4-4-12 hex karakterler<br>
                    xxxxxxxx-xxxx-4xxx-yxxx-xxxx<br><br>
                    <strong>Çarpışma Olasılığı:</strong><br>
                    2^122 kombinasyon<br>
                    Pratik olarak imkansız`,
                component: `<strong>uuid.New()</strong><br><br>
                    <em>Fonksiyon Çağırısı:</em><br>
                    uuid.New().String()<br><br>
                    <em>Üretilen ID:</em><br>
                    a1b2c3d4-e5f6-4789-<br>
                    abcd-ef0123456789<br><br>
                    <em>Kullanım Alanı:</em><br>
                    - Primary Key (devices.id)<br>
                    - URL'de kullanım`,
                content: `
                    <div class="code-block">
                        <span class="comment">// Generate unique ID - RFC 4122 UUID v4</span><br><br>
                        device.ID = uuid.<span class="function">New</span>().String()<br><br>
                        <span class="comment">// Result: "a1b2c3d4-e5f6-4789-abcd-ef0123456789"</span><br><br>
                        <span class="comment">// Mülakat: "Neden UUID?"</span><br>
                        <span class="comment">// - Auto-increment ID: Tahmin edilebilir (güvenlik riski)</span><br>
                        <span class="comment">// - UUID: Rastgele, güvenli, dağıtık sistemlerde çakışma yok</span>
                    </div>
                `,
                progress: 80
            },
            {
                title: "9. INSERT Sorgusu Çalıştırma",
                technical: `<strong>Veritabanı:</strong><br>
                    PostgreSQL 15+<br><br>
                    <strong>Connection Pool:</strong><br>
                    - sql.DB (database/sql)<br>
                    - Max Connections: 25<br><br>
                    <strong>Sorgu Tipi:</strong><br>
                    INSERT ... RETURNING<br><br>
                    <strong>Parametreler:</strong><br>
                    $1 = id (UUID)<br>
                    $2 = hostname (VARCHAR)<br>
                    $3 = ip (INET)<br>
                    $4-6 = vendor, model, status`,
                component: `<strong>DeviceRepository.Create()</strong><br><br>
                    <em>SQL Enjeksiyon Koruması:</em><br>
                    Prepared statements ($1, $2..)<br>
                    Placeholder parametreleri<br><br>
                    <em>Transaction:</em><br>
                    Implicit transaction<br>
                    Auto-commit on success<br><br>
                    <em>Performans:</em> ~2ms`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #10b981;">[PostgreSQL INSERT Operation]</div>
                        <p style="color: rgba(255,255,255,0.7);">Veritabanına yeni kayıt ekleniyor...</p>
                    </div>
                    <div class="db-query">
                        <span class="sql-keyword">INSERT INTO</span> <span class="sql-table">devices</span><br>
                        &nbsp;&nbsp;(<span class="sql-column">id, hostname, ip, vendor, model, status</span>)<br>
                        <span class="sql-keyword">VALUES</span><br>
                        &nbsp;&nbsp;(<span style="color: #bd93f9;">$1, $2, $3, $4, $5, $6</span>)<br>
                        <span class="sql-keyword">RETURNING</span> <span class="sql-column">id, created_at</span>;<br><br>
                        <span style="color: #6272a4;">-- Parametreler:</span><br>
                        <span style="color: #6272a4;">-- $1 = 'a1b2c3d4-e5f6-4789-abcd-ef0123456789'</span><br>
                        <span style="color: #6272a4;">-- $2 = 'ank-edge-rtr-05'</span><br>
                        <span style="color: #50fa7b;">-- Result: 1 row inserted</span>
                    </div>
                `,
                progress: 90
            },
            {
                title: "10. Yanıt: 201 Created",
                technical: `<strong>HTTP Status:</strong><br>
                    201 Created<br>
                    (RFC 7231 Section 6.3.2)<br><br>
                    <strong>Response Headers:</strong><br>
                    - Content-Type: application/json<br>
                    - Location: /devices/{id}<br>
                    - X-Request-ID: uuid<br>
                    - Cache-Control: no-store<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    - 201: Yeni kaynak oluşturuldu.<br>
                    - 202 Accepted: Uzun süren (asynchronous) işlemler için henüz bitmedi ama işleme alındı kodu.`,
                component: `<strong>http.ResponseWriter</strong><br><br>
                    <em>Response Yazma:</em><br>
                    1. w.Header().Set(...)<br>
                    2. w.WriteHeader(201)<br>
                    3. json.Encode(device)<br><br>
                    <em>Location Header:</em><br>
                    /devices/{yeni-uuid}<br><br>
                    <em>Toplam Süre:</em> ~15ms`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; color: #f59e0b;">[201 CREATED]</div>
                        <p style="color: rgba(255,255,255,0.6); margin-top: 10px;">
                            Toplam: ~15ms | Yeni Device Eklendi!
                        </p>
                    </div>
                    <div class="code-block" style="margin-bottom: 30px;">
                        <span class="comment">// HTTP/1.1 201 Created</span><br>
                        <strong>Location:</strong> /devices/a1b2c3d4-e5f6-4789-...<br>
                        <strong>Content-Type:</strong> application/json
                    </div>
                    <div class="json-response" style="border-color: #f59e0b; margin-bottom: 30px;">
                        {<br>
                        &nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">"a1b2c3d4-e5f6-4789-..."</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"hostname"</span>: <span class="json-string">"ank-edge-rtr-05"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"ip"</span>: <span class="json-string">"10.20.5.1"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"vendor"</span>: <span class="json-string">"Nokia"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"model"</span>: <span class="json-string">"7750 SR-1"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"status"</span>: <span class="json-string">"provisioning"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"created_at"</span>: <span class="json-string">"2026-02-03T23:10:00Z"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"_links"</span>: [<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;{<span class="json-key">"rel"</span>: <span class="json-string">"self"</span>, <span class="json-key">"href"</span>: <span class="json-string">"/devices/a1b2..."</span>},<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;{<span class="json-key">"rel"</span>: <span class="json-string">"interfaces"</span>, <span class="json-key">"href"</span>: <span class="json-string">"/devices/a1b2.../interfaces"</span>}<br>
                        &nbsp;&nbsp;]<br>
                        }
                    </div>
                    <div class="explanation" style="max-width: 500px; border-left-color: #f59e0b;">
                        <h4>Kaynak Başarıyla Oluşturuldu (Level 3 HATEOAS)</h4>
                        <p>
                            POST validated edildi ve DB'ye işlendi. 201 Created ile birlikte <strong>Location</strong> header eklendi. 
                            Yanıt gövdesinde <strong>_links</strong> alanı ile Richardson Seviye 3 (HATEOAS) sağlandı.
                        </p>
                    </div>
                `,
                progress: 100
            },
        ];

        // PUT Stages - Full replacement (10 adım)
        const putStages = [
            {
                title: "1. PUT İsteği - Tam Değiştirme",
                technical: `<strong>RFC 7231 §4.3.4</strong><br>
                    HTTP Method: PUT<br><br>
                    <strong>Properties:</strong><br>
                    - Safe: ? HAYIR<br>
                    - Idempotent: ? EVET<br>
                    - Cacheable: ? HAYIR<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"PUT neden idempotent?"</em><br>
                    Çünkü tam kaynak değişimi yapar,<br>
                    1 veya 100 çağrı sunucuda<br>
                    aynı sonucu (state) bırakır.`,
                component: `<strong>PUT /devices/{id}</strong><br><br>
                    <em>Network Automation:</em><br>
                    Nokia SR Linux cihazının tüm<br>
                    config'ini RESTCONF ile güncellemek<br>
                    PUT ile yapılır.<br><br>
                    <em>Dikkat:</em><br>
                    Eksik alan = null/default değer!<br>
                    PATCH'ten farkı budur.<br><br>
                    <em>Mülakat:</em><br>
                    "PUT vs PATCH farkı?"<br><br>
                    <em>Mülakat:</em><br>
                    - Conflict: 409 (State mismatch)<br>
                    - Precondition: 428 (If-Match header eksik)<br>
                    - Optimistic Locking: ETag kullanımı zorunlu mu? (RFC 428)</code>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; color: #3b82f6;">[PUT] ---> /api/v1/devices/{id}</div>
                        <p style="color: rgba(255,255,255,0.6); margin-top: 10px; font-size: 0.9rem;">
                            Fun Fact: PUT 1999'da HTTP/1.1 ile geldi (RFC 2616)
                        </p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// Full replacement - TÜM alanlar zorunlu!</span><br>
                        <span class="comment">// Nokia 7750 SR-14s router güncelleme</span><br>
                        {<br>
                        &nbsp;&nbsp;<span class="string">"hostname"</span>: <span class="string">"ist-core-rtr-01-v2"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"ip"</span>: <span class="string">"10.10.1.100"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"vendor"</span>: <span class="string">"Nokia"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"model"</span>: <span class="string">"7750 SR-14s"</span>,<br>
                        &nbsp;&nbsp;<span class="string">"status"</span>: <span class="string">"active"</span><br>
                        }
                    </div>
                `,
                progress: 10
            },
            {
                title: "2. HTTP Paketi Oluşturuluyor",
                technical: `<strong>Paket Katmanları:</strong><br><br>
                    [L7] <em>Application Layer</em><br>
                    &nbsp;&nbsp;-> HTTP Headers + Body<br><br>
                    [L4] <em>Transport Layer</em><br>
                    &nbsp;&nbsp;-> TCP Segmentasyon<br><br>
                    [L3] <em>Network Layer</em><br>
                    &nbsp;&nbsp;-> IP Adresleme<br><br>
                    <strong>Content-Type:</strong><br>
                    application/json`,
                component: `<strong>TCP/IP Stack</strong><br><br>
                    PUT body full replacement<br>
                    için tüm alanları içerir:<br><br>
                    <em>Content-Length:</em><br>
                    ~200 bytes JSON data<br><br>
                    <em>Encapsulation:</em><br>
                    Her katman header ekler`,
                content: `
                    <div class="packet visible">
                        <div class="packet-header">
                            <strong>[HTTP REQUEST HEADERS]</strong><br><br>
                            <span class="highlight">PUT</span> /devices/a1b2c3d4-... HTTP/1.1<br>
                            Host: localhost:3000<br>
                            If-Match: "def456" (Optimistic Locking)<br>
                            Content-Type: application/json<br>
                            Content-Length: 198<br>
                            Authorization: Bearer eyJhbGc...
                        </div>
                        <div class="packet-body">
                            <strong>[BODY]:</strong> {"hostname":"ist-core-rtr-01-v2",...}
                        </div>
                    </div>
                `,
                progress: 20
            },
            {
                title: "3. TLS/HTTPS Şifreleme",
                technical: `<strong>Full Context Encryption:</strong><br><br>
                    <strong>Data Integrity (MAC):</strong><br>
                    SHA-384 algoritması ile her paketin 'hash'i alınır. Yoldaki en ufak bit değişikliği bile sunucu tarafından anında yakalanır.<br><br>
                    <strong>Cipher:</strong><br>
                    AES-256-GCM (Galois/Counter Mode). Hem hızlıdır hem de ek bir 'authenication tag' üreterek tam güvenlik sağlar.<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"Hassas Veri Güvenliği?"</em><br>
                    URL'de asla hassas veri taşıma. Payload'ı minimize et (Sadece gerekli olanı gönder).`,
                component: `<strong>Crypto Core</strong><br><br>
                    <em>Cipher:</em> AES-256-GCM<br>
                    <em>Mode:</em> Symmetric Session<br><br>
                    <span style="color: var(--success);">[SECURE] PUT Body Protected</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 15px; color: var(--success);">[TLS ENCRYPTED]</div>
                        <p style="color: var(--success); font-weight: 600;">TLS Handshake Tamamlandı!</p>
                    </div>
                    <div class="server-box" style="border-color: var(--success);">
                        <h4 style="color: var(--success);">Şifreli Kanal Aktif</h4>
                        <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-bottom: 15px;">
                            AES-256-GCM ile şifrelenen veri:
                        </p>
                        <div style="background: #0d1117; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.75rem; word-break: break-all; color: var(--warning);">
                            x7f2a9c4e8b1d3f6a...encrypted_payload...
                            <br>k8m3n7p2q5r9s1t4...hmac_signature...
                        </div>
                    </div>
                `,
                progress: 30
            },
            {
                title: "4. Sunucu İsteği Alıyor",
                technical: `<strong>Sunucu:</strong> Go net/http<br><br>
                    <strong>Goroutine:</strong><br>
                    Her PUT isteği için yeni<br>
                    goroutine başlatılır<br><br>
                    <strong>İşlem Sırası:</strong><br>
                    1. TCP Accept()<br>
                    2. TLS Decrypt<br>
                    3. HTTP Parse<br>
                    4. Body buffering`,
                component: `<strong>http.Server{}</strong><br><br>
                    PUT body okunmaya hazır<br><br>
                    <em>Request:</em><br>
                    r.Method = "PUT"<br>
                    r.URL.Path = /devices/{id}<br>
                    r.Body = io.ReadCloser`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--secondary);">[SERVER RECEIVED PUT]</div>
                        <p style="color: rgba(255,255,255,0.7);">Sunucu PUT isteğini aldı...</p>
                    </div>
                    <div class="server-box" style="border-color: var(--secondary); margin-bottom: 20px;">
                        <h4 style="color: var(--secondary);">Handler Initiation</h4>
                        <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">İstek ayrıştırıldı ve doğru handler fonksiyonuna yönlendirildi.</p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// Go HTTP Server</span><br><br>
                        <span class="keyword">func</span> (s *Server) <span class="function">ServeHTTP</span>(w, r) {<br>
                        &nbsp;&nbsp;<span class="comment">// Method: PUT</span><br>
                        &nbsp;&nbsp;<span class="comment">// Path: /api/v1/devices/{id}</span><br>
                        &nbsp;&nbsp;<span class="comment">// Body: JSON payload ready</span><br>
                        }
                    </div>
                `,
                progress: 40
            },
            {
                title: "5. Router Path Eşleştirme",
                technical: `<strong>Router:</strong> Gorilla Mux<br><br>
                    <strong>Eşleşen Route:</strong><br>
                    PUT /devices/{id}<br>
                    -> UpdateDevice handler<br><br>
                    <strong>Path Parameter:</strong><br>
                    {id} = UUID değeri<br><br>
                    <strong>Method Check:</strong><br>
                    PUT == PUT (OK)`,
                component: `<strong>mux.Router{}</strong><br><br>
                    <em>mux.Vars(r):</em><br>
                    Path parameter çıkarma<br><br>
                    <em>Extracted ID:</em><br>
                    a1b2c3d4-e5f6-4789-...<br><br>
                    <em>Handler:</em><br>
                    handlers.UpdateDevice`,
                content: `
                    <div class="router-diagram">
                        <div class="route-item">
                            <span class="route-method get">GET</span>
                            <span class="route-path">/devices/{id}</span>
                        </div>
                        <div class="route-item matched">
                            <span class="route-method put">PUT</span>
                            <span class="route-path">/api/v1/devices/{id} ?</span>
                        </div>
                        <div class="route-item">
                            <span class="route-method patch">PATCH</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                        <div class="route-item">
                            <span class="route-method delete">DEL</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                    </div>
                `,
                progress: 50
            },
            {
                title: "6. Middleware Zinciri",
                technical: `<strong>State-Change Middleware:</strong><br><br>
                    1. <em>Idempotency Key Check</em><br>
                    &nbsp;&nbsp;› Aynı isteğin tekrarını engelleme.<br><br>
                    2. <em>Ownership Middleware</em><br>
                    &nbsp;&nbsp;› Kullanıcı bu cihaza erişebilir mi?<br><br>
                    3. <em>Validation Pipeline</em><br>
                    &nbsp;&nbsp;› JSON Şema doğrulaması.<br><br>
                    4. <em>Write Rate Limiter</em><br>
                    &nbsp;&nbsp;› Yazma işlemleri için daha dar limit.`,
                component: `<strong>Resource Permission Pipeline</strong><br><br>
                    <em>PUT Güvenliği:</em><br>
                    Kaynak sahipliği ve veri bütünlüğü kontrolü.<br><br>
                    <span style="color: var(--primary);">[CHECK] Object Ownership</span><br>
                    <span style="color: var(--success);">[PASS] Schema Valid</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <p style="color: rgba(255,255,255,0.7);">Update (PUT) güvenliği ve veri bütünlüğü kontrolleri yapılıyor...</p>
                    </div>
                    <div class="middleware-pipeline">
                        <div class="mw-item active">Idemp.Key</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Ownership</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Schema-Chk</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Write-Limit</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item" style="background: rgba(59,130,246,0.3); border-color: #3b82f6; opacity: 1;">[TARGET] UpdateDevice</div>
                    </div>
                `,
                progress: 60
            },
            {
                title: "7. JSON Parse & Path ID Çıkarma",
                technical: `<strong>İki Aşamalı İşlem:</strong><br><br>
                    <em>[1] Path ID:</em><br>
                    mux.Vars(r)["id"]<br>
                    UUID doğrulama<br><br>
                    <em>[2] Body Parse:</em><br>
                    json.NewDecoder(r.Body)<br>
                    Full replacement için<br>
                    TÜM alanlar zorunlu!<br><br>
                    <strong>Hata:</strong> 400 Bad Request`,
                component: `<strong>Handler Logic</strong><br><br>
                    <em>Validation:</em><br>
                    - UUID format kontrolü<br>
                    - JSON parse<br>
                    - Required fields check<br><br>
                    <em>PUT vs PATCH:</em><br>
                    PUT'ta eksik alan = hata!`,
                content: `
                    <div class="code-block">
                        <span class="comment">// UpdateDevice handler</span><br><br>
                        <span class="keyword">func</span> <span class="function">UpdateDevice</span>(w, r) {<br>
                        &nbsp;&nbsp;<span class="comment">// 1. Path'ten ID çıkar</span><br>
                        &nbsp;&nbsp;vars := mux.<span class="function">Vars</span>(r)<br>
                        &nbsp;&nbsp;id := vars[<span class="string">"id"</span>]<br><br>
                        &nbsp;&nbsp;<span class="comment">// 2. Body parse et</span><br>
                        &nbsp;&nbsp;<span class="keyword">var</span> device models.Device<br>
                        &nbsp;&nbsp;err := json.<span class="function">NewDecoder</span>(r.Body).Decode(&device)<br>
                        &nbsp;&nbsp;<span class="keyword">if</span> err != nil {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;http.Error(w, <span class="string">"422: Data Validation Error"</span>, 422)<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><br>
                        &nbsp;&nbsp;}<br>
                        }
                    </div>
                `,
                progress: 70
            },
            {
                title: "8. Varlık Kontrolü (SELECT EXISTS)",
                technical: `<strong>SELECT EXISTS Pattern</strong><br>
                    En hızlı varlık kontrolü<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"Conflict (409) ne zaman döner?"</em><br>
                    Mevcut kaynak state'i ile çakışan durumlarda 
                    (örn: ETag mismatch veya duplicate IP).<br><br>
                    <strong>Performans:</strong><br>
                    Index scan: ~0.5ms`,
                component: `<strong>Repository.GetByID()</strong><br><br>
                    <em>PostgreSQL EXPLAIN:</em><br>
                    Index Scan using devices_pkey<br>
                    Cost: 0.15..8.17<br><br>
                    <em>Sonuç:</em><br>
                    Device bulunamadı = 404<br>
                    Device bulundu = devam`,
                content: `
                    <div class="db-query">
                        <span class="comment">-- En hızlı varlık kontrolü</span><br><br>
                        <span class="sql-keyword">SELECT EXISTS</span>(<br>
                        &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> <span class="sql-column">1</span> <span class="sql-keyword">FROM</span> <span class="sql-table">devices</span><br>
                        &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> <span class="sql-column">id</span> = <span style="color: #bd93f9;">$1</span><br>
                        );<br><br>
                        <span style="color: #50fa7b;">-- Result: true</span><br>
                        <span style="color: #6272a4;">-- Nokia 7750 SR-14s bulundu!</span>
                    </div>
                `,
                progress: 80
            },
            {
                title: "9. UPDATE Sorgusu Çalıştırma",
                technical: `<strong>PostgreSQL 15+</strong><br>
                    MVCC ile concurrent update<br><br>
                    <strong>Güncellenen Kolonlar:</strong><br>
                    - hostname, ip, vendor<br>
                    - model, status<br>
                    - updated_at (OTOMATİK)<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"updated_at neden önemli?"</em><br>
                    - Audit trail<br>
                    - Cache invalidation<br>
                    - Conflict detection`,
                component: `<strong>DeviceRepository.Update()</strong><br><br>
                    <em>SQL Injection:</em><br>
                    Prepared statement koruması<br>
                    $1, $2... parametreler<br><br>
                    <em>EXPLAIN ANALYZE:</em><br>
                    Execution Time: ~2ms`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #3b82f6;">[PostgreSQL UPDATE Operation]</div>
                        <p style="color: rgba(255,255,255,0.7);">Mevcut kayıt tam içerikle değiştiriliyor...</p>
                    </div>
                    <div class="db-query">
                        <span class="comment">-- Full Resource Replacement</span><br><br>
                        <span class="sql-keyword">UPDATE</span> <span class="sql-table">devices</span><br>
                        <span class="sql-keyword">SET</span><br>
                        &nbsp;&nbsp;<span class="sql-column">hostname</span> = <span style="color: #bd93f9;">$2</span>,<br>
                        &nbsp;&nbsp;<span class="sql-column">ip</span> = <span style="color: #bd93f9;">$3</span>,<br>
                        &nbsp;&nbsp;<span class="sql-column">vendor</span> = <span style="color: #bd93f9;">$4</span>,<br>
                        &nbsp;&nbsp;<span class="sql-column">model</span> = <span style="color: #bd93f9;">$5</span>,<br>
                        &nbsp;&nbsp;<span class="sql-column">status</span> = <span style="color: #bd93f9;">$6</span>,<br>
                        &nbsp;&nbsp;<span class="sql-column">updated_at</span> = <span class="sql-keyword">NOW</span>()<br>
                        <span class="sql-keyword">WHERE</span> <span class="sql-column">id</span> = <span style="color: #bd93f9;">$1</span>;
                    </div>
                `,
                progress: 90
            },
            {
                title: "10. Yanıt: 200 OK",
                technical: `<strong>RFC 7231 §6.3.1</strong><br>
                    200 OK = Başarılı güncelleme<br><br>
                    <strong>Response Headers:</strong><br>
                    Content-Type: application/json<br>
                    X-Request-ID: tracing için<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"PUT 200 vs 204 farkı?"</em><br>
                    200: Body ile güncel kaynak<br>
                    204: Body yok, sadece başarı<br><br>
                    <strong>Idempotent Kanıtı:</strong><br>
                    Bu PUT'u 10x çağırsan<br>
                    hep aynı sonuç alırsın!`,
                component: `<strong>http.ResponseWriter</strong><br><br>
                    <em>Network Automation:</em><br>
                    Ansible/Nornir bu response'u<br>
                    alıp doğrulama yapar<br><br>
                    <em>Toplam Süre:</em><br>
                    Request -> Response: ~8ms`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; color: #3b82f6;">[200 OK - UPDATED]</div>
                        <p style="color: rgba(255,255,255,0.6); margin-top: 10px;">
                            Total: 8ms | Idempotent: Evet
                        </p>
                    </div>
                    <div class="json-response" style="border-color: #3b82f6; margin-bottom: 30px;">
                        <span class="comment">// Güncellenmiş Nokia router</span><br>
                        {<br>
                        &nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">"a1b2c3d4-e5f6-..."</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"hostname"</span>: <span class="json-string">"ist-core-rtr-01-v2"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"ip"</span>: <span class="json-string">"10.10.1.100"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"vendor"</span>: <span class="json-string">"Nokia"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"model"</span>: <span class="json-string">"7750 SR-14s"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"status"</span>: <span class="json-string">"active"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"etag"</span>: <span class="json-string">"W/\"ghi789\""</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"updated_at"</span>: <span class="json-string">"2026-02-03T23:15:00Z"</span><br>
                        }
                    </div>
                    <div class="explanation" style="max-width: 500px; border-left-color: #3b82f6;">
                        <h4>Kaynak Tamamen Değiştirildi</h4>
                        <p>
                            PUT isteği ile gönderilen yeni veri seti, mevcut kaynağın yerini aldı. Eksik alanların varsayılan değerlere 
                            çekileceği bu işlemde, idempotentlik korunarak sunucu durumu güncellendi.
                        </p>
                    </div>
                `,
                progress: 100
            },
        ];

        // PATCH Stages - Partial update
        // PATCH Stages - Partial update (10 adım)
        const patchStages = [
            {
                title: "1. PATCH İsteği - Kısmi Güncelleme",
                technical: `<strong>RFC 5789 (2010)</strong><br>
                    HTTP Method: PATCH<br><br>
                    <strong>Properties:</strong><br>
                    - Safe: ? HAYIR<br>
                    - Idempotent: ? HAYIR<br>
                    - Cacheable: ? HAYIR<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"PATCH neden idempotent değil?"</em><br>
                    Çünkü "x++" gibi increment<br>
                    işlemleri olabilir. Her çağrıda<br>
                    farklı sonuç alınabilir.`,
                component: `<strong>PATCH /devices/{id}</strong><br><br>
                    <em>Network Automation:</em><br>
                    Interface status değiştirme<br>
                    (up/down) PATCH ile yapılır.<br><br>
                    <em>Avantaj:</em><br>
                    - %80 bant genişliği tasarrufu<br>
                    - JSON Merge Patch (RFC 7396)<br>
                    - Concurrent update riski düşük`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; color: #8b5cf6;">[PATCH] ---> /api/v1/devices/{id}</div>
                        <p style="color: rgba(255,255,255,0.6); margin-top: 10px; font-size: 0.9rem;">
                            Fun Fact: PATCH 2010'da RFC 5789 ile standart oldu!
                        </p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// Partial update - sadece status değişiyor</span><br>
                        <span class="comment">// Nokia router maintenance mode'a alınıyor</span><br>
                        {<br>
                        &nbsp;&nbsp;<span class="string">"status"</span>: <span class="string">"maintenance"</span><br>
                        }
                    </div>
                `,
                progress: 10
            },
            {
                title: "2. OSI Katmanları & Kapsülleme",
                technical: `<strong>Paket Katmanları:</strong><br><br>
                    [L7] <em>Application</em>: PATCH Headers<br>
                    [L4] <em>Transport</em>: TCP (Reliable)<br>
                    [L3] <em>Network</em>: IP Addressing<br><br>
                    <strong>Content-Type:</strong><br>
                    application/json<br>
                    (Bazen application/merge-patch+json)`,
                component: `<strong>Encapsulation</strong><br><br>
                    Sadece değişecek olan<br>
                    JSON alanı paketlenir.<br><br>
                    <em>MTU:</em> 1500 bytes<br>
                    Küçük paketler network'te<br>
                    daha hızlı iletilir.`,
                content: `
                    <div class="packet visible">
                        <div class="packet-header">
                            <strong>[HTTP PATCH HEADERS]</strong><br><br>
                            <span class="highlight">PATCH</span> /api/v1/devices/a1b2c3d4-... HTTP/1.1<br>
                            Host: localhost:3000<br>
                            Content-Type: application/json
                        </div>
                        <div class="packet-body">
                            <strong>[PATCH BODY]:</strong> {"status":"maintenance"}
                        </div>
                    </div>
                `,
                progress: 20
            },
            {
                title: "3. TLS/HTTPS Şifreleme",
                technical: `<strong>Partial Update Security:</strong><br><br>
                    <strong>Key Exchange:</strong><br>
                    Diffie-Hellman algoritması kullanılarak sunucu ve istemci hiç birbirine anahtar göndermeden 'ortak bir anahtar' üzerinde anlaşırlar.<br><br>
                    <strong>Confidentiality:</strong><br>
                    PATCH ile gönderilen 'status' veya diğer hassas alanlar, network dinlense dahi okunamaz kabuk içine alınır.`,
                component: `<strong>Secure Pipeline</strong><br><br>
                    <em>Protocol:</em> TLS 1.3 (Modern)<br>
                    <em>PFS:</em> Enabled<br><br>
                    <span style="color: var(--success);">[SECURE] PATCH Segment Encrypted</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 15px; color: var(--success);">[TLS ENCRYPTED]</div>
                        <p style="color: var(--success); font-weight: 600;">TLS Handshake Tamamlandı!</p>
                    </div>
                    <div class="server-box" style="border-color: var(--success);">
                        <h4 style="color: var(--success);">Şifreli Kanal Aktif</h4>
                        <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-bottom: 15px;">
                            AES-256-GCM ile şifrelenen veri:
                        </p>
                        <div style="background: #0d1117; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.75rem; word-break: break-all; color: var(--warning);">
                            x7f2a9c4e8b1d3f6a...encrypted_payload...
                            <br>k8m3n7p2q5r9s1t4...hmac_signature...
                        </div>
                    </div>
                `,
                progress: 30
            },
            {
                title: "4. Sunucu İsteği Alıyor",
                technical: `<strong>Platform:</strong> Go Runtime<br><br>
                    <strong>Concurrency:</strong><br>
                    Goroutines (Lightweight threads)<br><br>
                    <strong>Resource Usage:</strong><br>
                    ~2 KB stack space per req<br>
                    Go'nun binlerce concurrent<br>
                    isteği karşılama gücü buradan gelir.`,
                component: `<strong>TCP Handshake</strong><br><br>
                    Sunucu bağlantıyı kabul etti.<br><br>
                    <em>TLS Termination:</em><br>
                    Sunucu tarafında decryption<br>
                    yapılıyor ve plain text<br>
                    işlenmeye başlanıyor.`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--secondary);">[SERVER PROCESSING PATCH]</div>
                        <p style="color: rgba(255,255,255,0.7);">İstek kuyruğa alındı...</p>
                    </div>
                    <div class="server-box" style="border-color: var(--secondary); margin-bottom: 20px;">
                        <h4 style="color: var(--secondary);">Go Runtime Execution</h4>
                        <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">İstek ayrıştırılarak ilgili handler goroutine'ine teslim edildi.</p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// Go net/http Listener</span><br><br>
                        <span class="keyword">go</span> <span class="function">handleRequest</span>(w, r) {<br>
                        &nbsp;&nbsp;<span class="comment">// Yeni goroutine içinde</span><br>
                        &nbsp;&nbsp;<span class="comment">// PATCH isteği ayrıştırılıyor</span><br>
                        }
                    </div>
                `,
                progress: 40
            },
            {
                title: "5. Router Path Eşleştirme",
                technical: `<strong>Router:</strong> Gorilla Mux<br><br>
                    <strong>Regex Matching:</strong><br>
                    /devices/{id:[a-z0-9-]+}<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"Neden farklı metodlar?"</em><br>
                    Sematik API tasarımı için.<br>
                    Metod = Yapılacak Eylem`,
                component: `<strong>mux.Router{}</strong><br><br>
                    <em>Matched Method:</em> PATCH<br>
                    <em>Matched Path:</em> /devices/{id}<br><br>
                    <em>Handler:</em><br>
                    handlers.PatchDevice`,
                content: `
                    <div class="router-diagram">
                        <div class="route-item">
                            <span class="route-method get">GET</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                        <div class="route-item">
                            <span class="route-method put">PUT</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                        <div class="route-item matched">
                            <span class="route-method patch">PATCH</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                    </div>
                `,
                progress: 50
            },
            {
                title: "6. Middleware Zinciri",
                technical: `<strong>State-Change Middleware:</strong><br><br>
                    1. <em>Idemp.Key Check</em><br>
                    &nbsp;&nbsp;› Garantili tekil işlem.<br><br>
                    2. <em>Ownership Check</em><br>
                    &nbsp;&nbsp;› Kaynak sahibi doğrulama.<br><br>
                    3. <em>Validation Pipeline</em><br>
                    &nbsp;&nbsp;› Sadece değişecek alanların şema kontrolü.<br><br>
                    4. <em>Write Limit</em><br>
                    &nbsp;&nbsp;› Yazma hızı sınırlama.`,
                component: `<strong>Patch Optimization Pipeline</strong><br><br>
                    <em>Alan Bazlı Yetki:</em><br>
                    Cihazın hangi alanlarının değişebileceği süzgeçten geçiyor.<br><br>
                    <span style="color: #8b5cf6;">[OPTI] If-Match Header OK</span><br>
                    <span style="color: var(--success);">[PASS] Schema Valid</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <p style="color: rgba(255,255,255,0.7);">Partial Update (PATCH) yetki ve çakışma kontrolleri yapılıyor...</p>
                    </div>
                    <div class="middleware-pipeline">
                        <div class="mw-item active">Idemp.Key</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Ownership</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Schema-Chk</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Write-Limit</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item" style="background: rgba(139,92,246,0.3); border-color: #8b5cf6; opacity: 1;">[TARGET] PatchDevice</div>
                    </div>
                `,
                progress: 60
            },
            {
                title: "7. JSON Parse & Mevcut Kayıt Getir",
                technical: `<strong>Neden Gerekli?</strong><br>
                    PATCH kısmi update yapar,<br>
                    mevcut veriyle merge lazım.<br><br>
                    <strong>Sorgu Tipi:</strong><br>
                    SELECT * FROM devices<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"PATCH'te neden önce SELECT?"</em><br>
                    Değişmeyen alanları korumak için.`,
                component: `<strong>Repository.GetByID()</strong><br><br>
                    <em>Nornir Automation:</em><br>
                    Cihazın son durumu DB'den<br>
                    okunuyor.<br><br>
                    <em>Status:</em> active (Eski)`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #a855f7;">[PostgreSQL Fetch Existing State]</div>
                        <p style="color: rgba(255,255,255,0.7);">Güncelleme öncesi mevcut veri okunuyor...</p>
                    </div>
                    <div class="db-query">
                        <span class="comment">-- Mevcut bilgiyi al</span><br>
                        <span class="sql-keyword">SELECT</span> * <span class="sql-keyword">FROM</span> <span class="sql-table">devices</span><br>
                        <span class="sql-keyword">WHERE</span> <span class="sql-column">id</span> = <span style="color: #bd93f9;">$1</span>;<br><br>
                        <span style="color: #6272a4;">-- Nokia 7750 SR-14s bulundu</span>
                    </div>
                `,
                progress: 70
            },
            {
                title: "8. Alanları Birleştirme (Merge)",
                technical: `<strong>Merge Strategy:</strong><br>
                    JSON Merge Patch (RFC 7396)<br><br>
                    <strong>Birleştirme Kuralları:</strong><br>
                    - null › alanı sil<br>
                    - değer › alanı güncelle<br>
                    - yok › alanı koru`,
                component: `<strong>Merge Logic</strong><br><br>
                    <em>Değişen:</em> status<br>
                    <em>Korunan:</em> hostname, ip, vendor<br><br>
                    <em>Otomatik:</em><br>
                    updated_at = NOW()`,
                content: `
                    <div class="code-block">
                        <span class="comment">// Sadece gönderilen alanları birleştir</span><br>
                        <span class="keyword">if</span> update.Status != <span class="string">""</span> {<br>
                        &nbsp;&nbsp;existing.Status = update.Status<br>
                        }<br>
                        <span class="comment">// Diğer alanlar korunuyor...</span>
                    </div>
                `,
                progress: 80
            },
            {
                title: "9. Dinamik UPDATE Sorgusu",
                technical: `<strong>Query Builder Pattern:</strong><br>
                    Sadece değişen kolonları SET<br><br>
                    <strong>Bu PATCH'te:</strong><br>
                    SET status = $2<br>
                    SET updated_at = NOW()<br><br>
                    <strong>Execution Time:</strong> ~1.5ms`,
                component: `<strong>SQL Query Builder</strong><br><br>
                    <em>Index Usage:</em><br>
                    PRIMARY KEY (id) kullanıldığı<br>
                    için çok hızlıdır.`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #a855f7;">[PostgreSQL Dynamic Update]</div>
                        <p style="color: rgba(255,255,255,0.7);">Sadece değişen alanlar PostgreSQL'e yazılıyor...</p>
                    </div>
                    <div class="db-query">
                        <span class="comment">-- Sadece değişen kolonlar</span><br>
                        <span class="sql-keyword">UPDATE</span> <span class="sql-table">devices</span><br>
                        <span class="sql-keyword">SET</span> <span class="sql-column">status</span> = <span style="color: #bd93f9;">$2</span>,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-column">updated_at</span> = <span class="sql-keyword">NOW</span>()<br>
                        <span class="sql-keyword">WHERE</span> <span class="sql-column">id</span> = <span style="color: #bd93f9;">$1</span>;
                    </div>
                `,
                progress: 90
            },
            {
                title: "10. Yanıt: 200 OK",
                technical: `<strong>RFC 7231 §6.3.1</strong><br>
                    200 OK = Başarılı güncelleme<br><br>
                    <strong>Response Body:</strong><br>
                    Tüm güncel alanlar döner.<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"PATCH Safe mi?"</em><br>
                    Hayır, state değiştirir.<br><br>
                    <em>Mülakat:</em><br>
                    "Optimistic Locking (ETag)"<br>
                    "428 Precondition Required"`,
                component: `<strong>http.ResponseWriter</strong><br><br>
                    <em>Total Time:</em> ~5ms<br><br>
                    <em>Idempotent:</em> HAYIR<br>
                    (RFC Teknik detayı)`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; color: #8b5cf6;">[200 OK - PATCHED]</div>
                        <p style="color: rgba(255,255,255,0.6); margin-top: 10px;">
                            Total: 5ms | Cihaz Güncellendi
                        </p>
                    </div>
                    <div class="json-response" style="border-color: #8b5cf6; margin-bottom: 30px;">
                        {<br>
                        &nbsp;&nbsp;<span class="json-key">"status"</span>: <span class="json-string">"maintenance"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"updated_at"</span>: <span class="json-string">"2026-02-03T23:20:00Z"</span>,<br>
                        &nbsp;&nbsp;<span class="json-key">"etag"</span>: <span class="json-string">"W/\"def456\""</span><br>
                        }
                    </div>
                    <div class="explanation" style="max-width: 500px; border-left-color: #8b5cf6;">
                        <h4>Kısmi Güncelleme Tamamlandı</h4>
                        <p>
                            PATCH isteği ile sadece 'status' alanı güncellendi. JSON Merge Patch stratejisi kullanılarak mevcut veri korundu 
                            ve veritabanı sorgusu optimize edilerek minimum I/O ile işlem bitirildi.
                        </p>
                    </div>
                `,
                progress: 100
            }
        ];

        // DELETE Stages
        // DELETE Stages - Resource Removal (10 adım)
        const deleteStages = [
            {
                title: "1. DELETE İsteği - Kaynak Silme",
                technical: `<strong>RFC 7231 §4.3.5</strong><br>
                    HTTP Method: DELETE<br><br>
                    <strong>Properties:</strong><br>
                    - Safe: ? HAYIR<br>
                    - Idempotent: ? EVET<br>
                    - Cacheable: ? HAYIR<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"DELETE neden idempotent?"</em><br>
                    Response kodu değişse (204 -> 404)<br>
                    bile sunucu state'i aynı kalır.`,
                component: `<strong>DELETE /devices/{id}</strong><br><br>
                    <em>Soft Delete Stratejisi:</em><br>
                    Veriyi fiziksel silmek yerine 
                    'deleted_at' timestamp ekle.<br><br>
                    <em>Neden?</em> Kayıt geçmişini korumak 
                    ve 'Restore' imkanı sağlamak için.`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; color: #ef4444;">[DELETE] ---> /api/v1/devices/{id}</div>
                        <p style="color: rgba(255,255,255,0.6); margin-top: 10px; font-size: 0.9rem;">
                            Fun Fact: HTTP/1.1 (1997) ile gelen orijinal metod!
                        </p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// Nokia 7750 SR-14s kaldırılıyor</span><br>
                        DELETE /api/v1/devices/a1b2... HTTP/1.1<br>
                        Authorization: Bearer eyJhbG...<br>
                        X-Request-ID: req-98765
                    </div>
                `,
                progress: 10
            },
            {
                title: "2. OSI Katmanları & Kapsülleme",
                technical: `<strong>Paket Katmanları:</strong><br><br>
                    [L7] Application Layer (Headers)<br>
                    [L4] Transport Layer (TCP ACK)<br>
                    [L3] Network Layer (IP Routing)<br><br>
                    <strong>Body: YOK</strong><br>
                    RFC'ye göre DELETE body<br>
                    içermez (ignore edilir).`,
                component: `<strong>OSI Stack</strong><br><br>
                    Küçük paket boyutu.<br>
                    <em>Payload:</em> 0 bytes<br><br>
                    <em>Control:</em><br>
                    Sadece HTTP headers<br>
                    ve URI yeterlidir.`,
                content: `
                    <div class="packet visible">
                        <div class="packet-header">
                            <strong>[HTTP DELETE HEADERS]</strong><br><br>
                            <span class="highlight">DELETE</span> /api/v1/devices/a1b2... HTTP/1.1<br>
                            Host: localhost:3000<br>
                            Authorization: Bearer ...
                        </div>
                        <div class="packet-body" style="color: #6272a4;">
                            // Body: EMPTY (RFC 7231)
                        </div>
                    </div>
                `,
                progress: 20
            },
            {
                title: "3. TLS/HTTPS Şifreleme",
                technical: `<strong>Destructive Req. Security:</strong><br><br>
                    <strong>Authentication Tag:</strong><br>
                    GCM modu her şifreleme bloğu için bir 'Tag' (MAC) üretir. Sunucu bu tag'i kontrol ederek verinin yolda manipüle edilmediğinden emin olur.<br><br>
                    <strong>Privacy:</strong><br>
                    Silinecek kaynağın UUID'si ve Bearer Token, ağ üzerinde sadece anlamsız hexadecimal karakterler olarak görülür.`,
                component: `<strong>Encryption Shield</strong><br><br>
                    <em>Algorithm:</em> AES-GCM<br>
                    <em>Integrity:</em> SHA-384<br><br>
                    <span style="color: var(--success);">[SECURE] DELETE Resource Hidden</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 15px; color: var(--success);">[TLS ENCRYPTED]</div>
                        <p style="color: var(--success); font-weight: 600;">TLS Handshake Tamamlandı!</p>
                    </div>
                    <div class="server-box" style="border-color: var(--success);">
                        <h4 style="color: var(--success);">Şifreli Kanal Aktif</h4>
                        <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-bottom: 15px;">
                            AES-256-GCM ile şifrelenen veri:
                        </p>
                        <div style="background: #0d1117; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.75rem; word-break: break-all; color: var(--warning);">
                            x7f2a9c4e8b1d3f6a...encrypted_payload...
                            <br>k8m3n7p2q5r9s1t4...hmac_signature...
                        </div>
                    </div>
                `,
                progress: 30
            },
            {
                title: "4. Sunucu İsteği Alıyor",
                technical: `<strong>Sunucu:</strong> Go net/http<br><br>
                    <strong>İşlem Akışı:</strong><br>
                    1. TLS Handshake verify<br>
                    2. Decrypt raw bytes<br>
                    3. HTTP request struct object<br><br>
                    <strong>Resource management:</strong><br>
                    Goroutine pool tarafından işlenir.`,
                component: `<strong>http.Server{}</strong><br><br>
                    Sunucu DELETE çağrısını<br>
                    kabul etti.<br><br>
                    <em>Request Context:</em><br>
                    r.Method = "DELETE"<br>
                    r.RemoteAddr = 1.2.3.4`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 15px; color: var(--secondary);">[SERVER RECEIVING DELETE]</div>
                        <p style="color: rgba(255,255,255,0.7);">İstek handler'a yönlendiriliyor...</p>
                    </div>
                    <div class="server-box" style="border-color: var(--secondary); margin-bottom: 20px;">
                        <h4 style="color: var(--secondary);">Go HTTP Server</h4>
                        <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">Silme isteği sistem tarafından doğrulanmaya başlandı.</p>
                    </div>
                    <div class="code-block">
                        <span class="comment">// Go net/http server loop</span><br>
                        <span class="keyword">func</span> handle(w, r) {<br>
                        &nbsp;&nbsp;<span class="comment">// r.Method == "DELETE"</span><br>
                        }
                    </div>
                `,
                progress: 40
            },
            {
                title: "5. Router Path Eşleştirme",
                technical: `<strong>Router:</strong> Gorilla Mux<br><br>
                    <strong>Matching Logic:</strong><br>
                    Path: /devices/{id}<br>
                    Method: DELETE<br><br>
                    <strong>ID Extraction:</strong><br>
                    mux.Vars(r)["id"]`,
                component: `<strong>mux.Router{}</strong><br><br>
                    <em>Matched:</em><br>
                    handlers.DeleteDevice<br><br>
                    <em>Var:</em><br>
                    id: a1b2c3d4-...`,
                content: `
                    <div class="router-diagram">
                        <div class="route-item">
                            <span class="route-method get">GET</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                        <div class="route-item matched">
                            <span class="route-method delete">DEL</span>
                            <span class="route-path">/api/v1/devices/{id}</span>
                        </div>
                    </div>
                `,
                progress: 50
            },
            {
                title: "6. Middleware Zinciri",
                technical: `<strong>Critical Operation Protection:</strong><br><br>
                    1. <em>Audit Trace</em><br>
                    &nbsp;&nbsp;› Kim sildi? (Logging).<br><br>
                    2. <em>Admin Enforce</em><br>
                    &nbsp;&nbsp;› Sadece Admin rolü silebilir.<br><br>
                    3. <em>Integrity Check</em><br>
                    &nbsp;&nbsp;› Bağımlı (nested) kaynak kontrolü.<br><br>
                    4. <em>Write Limit</em><br>
                    &nbsp;&nbsp;› Yıkıcı işlemler için koruma.`,
                component: `<strong>Destructive Action Pipeline</strong><br><br>
                    <em>Geri Dönülemez İşlem:</em><br>
                    Sistem bu aşamada tüm güvenlik kilitlerini devreye sokar.<br><br>
                    <span style="color: var(--danger);">[LOG] Writing Audit Trace</span><br>
                    <span style="color: var(--success);">[AUTH] Admin Role Confirmed</span>`,
                content: `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <p style="color: rgba(255,255,255,0.7);">Kritik (DELETE) işlemi öncesi güvenlik kilitleri doğrulanıyor...</p>
                    </div>
                    <div class="middleware-pipeline">
                        <div class="mw-item active">Audit-Trace</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Admin-Enforce</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Integrity-Pre</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item active">Write-Limit</div>
                        <span class="mw-arrow">-></span>
                        <div class="mw-item" style="background: rgba(239,68,68,0.3); border-color: #ef4444; opacity: 1;">[TARGET] DeleteDevice</div>
                    </div>
                `,
                progress: 60
            },
            {
                title: "7. Varlık Doğrulama (SELECT)",
                technical: `<strong>Kaynak Kontrolü:</strong><br>
                    Silmeden önce var mı?<br><br>
                    <strong>Status Code Kararı:</strong><br>
                    404 Not Found (Eğer yoksa)<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"Neden direkt DELETE değil?"</em><br>
                    Uygulama mantığını korumak ve<br>
                    bağımlılıkları kontrol etmek için.`,
                component: `<strong>Repository.GetByID()</strong><br><br>
                    <em>PostgreSQL Plan:</em><br>
                    Index Scan using pkey<br><br>
                    <em>Status:</em><br>
                    Nokia 7750 bulundu!<br>
                    Devam edilebilir.`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #ef4444;">[PostgreSQL Existence Check]</div>
                        <p style="color: rgba(255,255,255,0.7);">Kaynak silinmeden önce varlığı doğrulanıyor...</p>
                    </div>
                    <div class="db-query">
                        <span class="comment">-- Silmeden önce SELECT</span><br>
                        <span class="sql-keyword">SELECT</span> <span class="sql-column">id, hostname</span><br>
                        <span class="sql-keyword">FROM</span> <span class="sql-table">devices</span><br>
                        <span class="sql-keyword">WHERE</span> <span class="sql-column">id</span> = <span style="color: #bd93f9;">$1</span>;<br><br>
                        <span style="color: #50fa7b;">-- Result: Nokia 7750 SR-14s</span>
                    </div>
                `,
                progress: 70
            },
            {
                title: "8. Foreign Key Kontrolü",
                technical: `<strong>Referential Integrity:</strong><br>
                    PostgreSQL FOREIGN KEY<br><br>
                    <strong>Kontrol:</strong><br>
                    interfaces.device_id -> devs.id<br><br>
                    <strong>Kural:</strong> RESTRICT<br>
                    Eğer cihazda interface varsa<br>
                    silmeyi ENGELLE! (409 Conflict)`,
                component: `<strong>Constraint Check</strong><br><br>
                    <em>Network DB:</em><br>
                    Bağlı VLAN veya Interface<br>
                    var mı sorgulanıyor.<br><br>
                    <em>Count:</em> 0 (Safe to delete)`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #ef4444;">[PostgreSQL Constraint Check]</div>
                        <p style="color: rgba(255,255,255,0.7);">İlişkili veriler (Foreign Key) kontrol ediliyor...</p>
                    </div>
                    <div class="db-query">
                        <span class="comment">-- Bağımlılık kontrolü (SELECT COUNT)</span><br>
                        <span class="sql-keyword">SELECT COUNT</span>(*) <span class="sql-keyword">FROM</span> <span class="sql-table">interfaces</span><br>
                        <span class="sql-keyword">WHERE</span> <span class="sql-column">device_id</span> = <span style="color: #bd93f9;">$1</span>;<br><br>
                        <span style="color: #50fa7b;">-- Result: 0 (No dependents)</span>
                    </div>
                `,
                progress: 80
            },
            {
                title: "9. DELETE Sorgusu Çalıştırma",
                technical: `<strong>SQL:</strong> Hard DELETE<br><br>
                    <strong>Mülakat İpucu:</strong><br>
                    <em>"Hard vs Soft Delete?"</em><br>
                    Hard: Gerçek silme.<br>
                    Soft: is_deleted = TRUE.<br><br>
                    Biz gerçek silme yapıyoruz.<br>
                    (RETURNING id ile teyit)`,
                component: `<strong>DeviceRepository.Delete()</strong><br><br>
                    <em>PostgreSQL Execution:</em><br>
                    DELETE from devices...<br>
                    Execution time: ~1ms<br><br>
                    Cihaz envanterden kalktı.`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px; color: #ef4444;">[PostgreSQL Final DELETE]</div>
                        <p style="color: rgba(255,255,255,0.7);">Kayıt veritabanından kalıcı olarak kaldırılıyor...</p>
                    </div>
                    <div class="db-query">
                        <span class="comment">-- Hard DELETE - Geri dönüşü yok</span><br>
                        <span class="sql-keyword">DELETE FROM</span> <span class="sql-table">devices</span><br>
                        <span class="sql-keyword">WHERE</span> <span class="sql-column">id</span> = <span style="color: #bd93f9;">$1</span><br>
                        <span class="sql-keyword">RETURNING</span> <span class="sql-column">id</span>;<br><br>
                        <span style="color: #50fa7b;">-- 1 row deleted</span>
                    </div>
                `,
                progress: 90
            },
            {
                title: "10. Yanıt: 204 No Content",
                technical: `<strong>RFC 7231 §6.3.5</strong><br>
                    204 No Content<br><br>
                    <strong>Neden 204?</strong><br>
                    Geri dönecek veri yok,<br>
                    silme işlemi başarılı.<br><br>
                    <strong>Body:</strong> Boş (MUST NOT)`,
                component: `<strong>http.ResponseWriter</strong><br><br>
                    <em>Response:</em><br>
                    w.WriteHeader(204)<br><br>
                    <em>Idempotent:</em> EVET<br>
                    (Sunucu durumu korundu)`,
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2rem; color: #ef4444;">[204 NO CONTENT]</div>
                        <p style="color: rgba(255,255,255,0.6); margin-top: 10px;">
                            Total: 3ms | Silme Tamamlandı
                        </p>
                    </div>
                    <div class="code-block" style="margin-bottom: 30px;">
                        <span class="comment">// HTTP/1.1 204 No Content</span><br>
                        <span class="comment">// Body is empty by design</span><br><br>
                        X-Request-ID: req-98765<br>
                        Date: Mon, 03 Feb 2026 23:20:00 GMT
                    </div>
                    <div class="explanation" style="max-width: 500px; border-left-color: #ef4444;">
                        <h4>Kaynak Başarıyla Silindi</h4>
                        <p>
                            DELETE isteği doğrultusunda kaynak veritabanından kalıcı olarak kaldırıldı. Bağımlılık kontrolleri ve yetki 
                            denetimleri başarıyla tamamlandığı için 204 No Content yanıtı ile işlem sonlandırıldı.
                        </p>
                    </div>
                `,
                progress: 100
            }
        ];

        // All stages by method
        const allStages = {
            GET: stages,
            POST: postStages,
            PUT: putStages,
            PATCH: patchStages,
            DELETE: deleteStages
        };

        let currentMethod = 'GET';
        let currentStages = allStages[currentMethod];
        let currentStage = -1;

        const progressBar = document.getElementById('progressBar');
        const stageIndicator = document.getElementById('stageIndicator');
        const vizTitle = document.getElementById('vizTitle');
        const vizContent = document.getElementById('vizContent');
        const technicalDetails = document.getElementById('technicalDetails');
        const activeComponent = document.getElementById('activeComponent');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const resetBtn = document.getElementById('resetBtn');

        function updateStage(stageIndex) {
            if (stageIndex < 0 || stageIndex >= currentStages.length) return;

            currentStage = stageIndex;
            const stage = currentStages[stageIndex];

            // Update progress bar
            progressBar.style.width = stage.progress + '%';

            // Update stage indicators
            document.querySelectorAll('.stage-dot').forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index < stageIndex) {
                    dot.classList.add('completed');
                } else if (index === stageIndex) {
                    dot.classList.add('active');
                }
            });

            // Update center visualization
            vizTitle.textContent = stage.title;
            vizContent.innerHTML = stage.content;

            // Update side panels
            technicalDetails.innerHTML = stage.technical;
            activeComponent.innerHTML = stage.component;

            // Update buttons
            prevBtn.disabled = stageIndex === 0;
            nextBtn.textContent = stageIndex === currentStages.length - 1 ? '[RESET] Yeniden Başlat' : 'Sonraki';
        }

        nextBtn.addEventListener('click', () => {
            if (currentStage === currentStages.length - 1) {
                // Reset
                currentStage = -1;
                progressBar.style.width = '0%';
                document.querySelectorAll('.stage-dot').forEach(dot => {
                    dot.classList.remove('active', 'completed');
                });
                vizTitle.textContent = 'HTTP İstek Simülasyonu';
                vizContent.innerHTML = `
                <div style="text-align: center; color: rgba(255,255,255,0.6);">
                <p style="font-size: 3rem; margin-bottom: 20px;"></p>
                <p>Animasyonu başlatmak için aşağıdaki butonu kullanın.</p>
                </div>
                `;
                technicalDetails.innerHTML = '<p style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">Animasyonu başlatmak için "Animasyonu Başlat" butonuna tıklayın.</p>';
                activeComponent.innerHTML = '<p style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">Henüz bir bileşen aktif değil.</p>';
                nextBtn.textContent = 'Animasyonu Başlat';
                prevBtn.disabled = true;
            } else {
                updateStage(currentStage + 1);
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentStage > 0) {
                updateStage(currentStage - 1);
            }
        });

        resetBtn.addEventListener('click', () => {
            currentStage = currentStages.length - 1;
            nextBtn.click(); // Trigger reset logic
        });

        // Method selector logic
        document.querySelectorAll('.method-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const method = btn.dataset.method;
                currentMethod = method;
                currentStages = allStages[method];
                currentStage = -1;

                // Update button styles
                document.querySelectorAll('.method-btn').forEach(b => {
                    b.style.background = 'transparent';
                });
                btn.style.background = `rgba(${method === 'GET' ? '16,185,129' : method === 'POST' ? '245,158,11' : method === 'PUT' ? '59,130,246' : method === 'PATCH' ? '139,92,246' : '239,68,68'},0.2)`;

                // Reset visualization
                progressBar.style.width = '0%';
                document.querySelectorAll('.stage-dot').forEach(dot => {
                    dot.classList.remove('active', 'completed');
                });
                vizTitle.textContent = method + ' Request Lifecycle';
                vizContent.innerHTML = `<div style="text-align: center; color: rgba(255,255,255,0.6);"><p style="font-size: 1.5rem; margin-bottom: 20px; color: var(--primary);">[${method}]</p><p>Animasyonu başlatmak için butona tıklayın.</p></div>`;
                nextBtn.textContent = 'Animasyonu Başlat';
                prevBtn.disabled = true;
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                nextBtn.click();
            } else if (e.key === 'ArrowLeft') {
                prevBtn.click();
            }
        });
    </script>
</body>

</html>